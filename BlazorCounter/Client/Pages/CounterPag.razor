@page "/counterpag"
@using BlazorCounter.Client.Components
@using Microsoft.AspNetCore.Authorization
@using Microsoft.Extensions.DependencyInjection
@using System.Net.Http.Json

@attribute [Authorize]
@inject HttpClient Http

<CounterComp Skip = "Salto" Cont = "CurrentCount" OnSalva = "SalvaContatore" Up = "Su" Down = "Giu"/>

@code {
    public Models.ContatoreCli? CurrentCount {  get; set; } = new Models.ContatoreCli();

    private string? apiUrl = @"http://localhost:5002/api/ContatoreSer";

    private int Salto = 1;

    protected override Task OnInitializedAsync()
    {
        return caricaEventi();
    }

    private async Task caricaEventi()
    {
        CurrentCount = await Http.GetFromJsonAsync<Models.ContatoreCli>($"{apiUrl}/{5}");
    }

    public async Task SalvaContatore(Models.ContatoreCli con)
    {
        await Http.PutAsJsonAsync($"{apiUrl}/{5}", con);
        await caricaEventi();
    }

    public void Su()
    {
        CurrentCount.Valore += Salto;

    }

    public void Giu()
    {
        CurrentCount.Valore -= Salto;
    }
}
